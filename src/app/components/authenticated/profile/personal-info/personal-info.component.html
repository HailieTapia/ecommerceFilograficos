<div class="bg-light-background dark:bg-dark-background shadow-md rounded-lg p-6 border border-gray-200 dark:border-gray-600">
  <div class="border-t-2 border-light-primary dark:border-dark-primary pt-6">
    <h2 class="text-lg font-medium text-light-text dark:text-dark-text mb-4">Información Personal</h2>
    <form [formGroup]="profileForm">
      <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
        <!-- Nombre -->
        <div class="sm:col-span-3">
          <label for="name" class="block text-sm font-medium text-light-secondary dark:text-dark-secondary flex items-center gap-2">
            Nombre <span class="text-light-danger dark:text-dark-danger">*</span>
          </label>
          <div class="relative">
            <input type="text" formControlName="name"
              class="mt-1 p-2 pl-10 block w-full bg-light-background dark:bg-dark-background border border-gray-200 dark:border-gray-600 rounded-md shadow-sm text-light-text dark:text-dark-text placeholder-light-secondary dark:placeholder-dark-secondary focus:ring-2 focus:ring-light-primary-hover dark:focus:ring-dark-primary-hover focus:border-light-primary-hover dark:focus:border-dark-primary-hover transition-all duration-300">
            <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-light-primary dark:text-dark-primary"></i>
            <div *ngIf="profileForm.controls['name'].touched && profileForm.controls['name'].invalid"
              class="text-light-danger dark:text-dark-danger text-xs mt-1">
              <span *ngIf="profileForm.controls['name'].errors?.['required']">El nombre es obligatorio.</span>
              <span *ngIf="profileForm.controls['name'].errors?.['minlength']">Mínimo 2 caracteres.</span>
              <span *ngIf="profileForm.controls['name'].errors?.['maxlength']">Máximo 100 caracteres.</span>
              <span *ngIf="profileForm.controls['name'].errors?.['pattern']">Solo letras, espacios, guiones y apóstrofes son permitidos.</span>
            </div>
          </div>
        </div>

        <!-- Correo electrónico -->
        <div class="sm:col-span-6">
          <label for="email" class="block text-sm font-medium text-light-secondary dark:text-dark-secondary">Correo electrónico</label>
          <div class="mt-1 p-2 pl-10 bg-light-background dark:bg-dark-background border border-gray-200 dark:border-gray-600 rounded-md shadow-sm text-light-text dark:text-dark-text flex items-center gap-2">
            <i class="fas fa-envelope text-light-primary dark:text-dark-primary"></i>
            <span>{{ userProfile.email }}</span>
          </div>
        </div>

        <!-- Teléfono -->
        <div class="sm:col-span-3">
          <label for="phone" class="block text-sm font-medium text-light-secondary dark:text-dark-secondary flex items-center gap-2">
            Teléfono <span class="text-light-danger dark:text-dark-danger">*</span>
          </label>
          <div class="relative">
            <input type="tel" maxlength="10" formControlName="phone"
              class="mt-1 p-2 pl-10 block w-full bg-light-background dark:bg-dark-background border border-gray-200 dark:border-gray-600 rounded-md shadow-sm text-light-text dark:text-dark-text placeholder-light-secondary dark:placeholder-dark-secondary focus:ring-2 focus:ring-light-primary-hover dark:focus:ring-dark-primary-hover focus:border-light-primary-hover dark:focus:border-dark-primary-hover transition-all duration-300">
            <i class="fas fa-phone absolute left-3 top-1/2 transform -translate-y-1/2 text-light-primary dark:text-dark-primary"></i>
            <div *ngIf="profileForm.controls['phone'].touched && profileForm.controls['phone'].invalid"
              class="text-light-danger dark:text-dark-danger text-xs mt-1">
              <span *ngIf="profileForm.controls['phone'].errors?.['required']">El teléfono es obligatorio.</span>
              <span *ngIf="profileForm.controls['phone'].errors?.['maxlength']">Máximo 15 caracteres.</span>
              <span *ngIf="profileForm.controls['phone'].errors?.['pattern']">Solo números y el signo + son permitidos.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón de guardar -->
      <div class="mt-6 flex justify-end">
        <button (click)="updateProfile()"
          class="ml-3 inline-flex items-center gap-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-light-primary dark:bg-dark-primary hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-light-primary-hover dark:focus:ring-dark-primary-hover transition-all duration-300">
          <i class="fas fa-save"></i> Guardar cambios
        </button>
      </div>
    </form>
  </div>

  <!-- Sección de Insignias -->
  <div class="mt-10 pt-8 border-t-2 border-light-primary dark:border-dark-primary">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <i class="fas fa-award text-xl text-yellow-500"></i>
        <h3 class="text-xl font-semibold text-light-text dark:text-dark-text">Mis Insignias</h3>
      </div>
      <span class="text-sm text-light-secondary dark:text-dark-secondary">{{ (userProfile.badges && userProfile.badges.length) || 0 }} insignias obtenidas</span>
    </div>
    <div *ngIf="userProfile.badges && userProfile.badges.length > 0; else noBadges"
         class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
      <div *ngFor="let badge of userProfile.badges"
           class="group relative bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900 dark:to-orange-900 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl p-4 hover:shadow-lg transition-all duration-300 cursor-pointer hover:scale-105">
        <div class="flex flex-col items-center text-center">
          <img [src]="badge.icon_url" [alt]="badge.name" class="w-12 h-12 rounded-full object-cover mb-2">
          <h4 class="font-semibold text-sm text-light-text dark:text-dark-text mb-1">{{ badge.name }}</h4>
          <p class="text-xs text-light-secondary dark:text-dark-secondary mb-2">{{ badge.category }}</p>
          <div class="flex items-center gap-1 text-xs text-light-secondary dark:text-dark-secondary">
            <i class="fas fa-calendar-alt w-3 h-3"></i>
            <span>{{ badge.obtained_at | date:'dd MMM yyyy':'es-MX' }}</span>
          </div>
        </div>
        <!-- Tooltip en hover (ahora multilínea) -->
        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 dark:bg-gray-800 text-white dark:text-gray-200 text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none max-w-48 text-center whitespace-normal z-20">
          {{ badge.description }}
          <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900 dark:border-t-gray-800"></div>
        </div>
      </div>
    </div>
    <ng-template #noBadges>
      <p class="text-sm text-light-secondary dark:text-dark-secondary italic">No tienes insignias aún.</p>
    </ng-template>
  </div>
</div>