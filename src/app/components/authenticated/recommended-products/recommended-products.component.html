<section class="relative bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="bg-light-danger dark:bg-dark-danger text-light-danger-text dark:text-dark-danger-text p-4 rounded-lg mb-4">
      {{ errorMessage }}
      <button (click)="loadRecommendations()" class="ml-4 bg-light-primary dark:bg-dark-primary text-light-blanco dark:text-dark-text px-2 py-1 rounded-lg hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover">
        Reintentar
      </button>
    </div>

    <!-- Botones para cargar recomendaciones -->
    <div class="flex justify-center gap-4 mb-8" *ngIf="isAuthenticated">
      <button (click)="loadRecommendations()" class="bg-light-primary dark:bg-dark-primary text-light-blanco dark:text-dark-text px-4 py-2 rounded-lg hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover">
        Actualizar Recomendaciones
      </button>
    </div>

    <!-- Productos Recomendados -->
    <div *ngIf="recommendations && recommendations.data.recommendations.length > 0" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <div *ngFor="let product of recommendations.data.recommendations; let i = index" class="relative rounded-2xl overflow-hidden shadow-md hover:shadow-lg transition-shadow">
        <!-- Product Type Badge -->
        <div class="absolute top-3 left-3 z-10">
          <span class="bg-light-primary dark:bg-dark-primary text-light-blanco dark:text-dark-text text-xs font-medium px-2 py-1 rounded-full">
            {{ product.product_type || 'Sin tipo' }}
          </span>
        </div>

        <!-- Cart Icon -->
        <div class="absolute top-3 right-3 z-10">
          <button (click)="addToCart(product)" class="w-8 h-8 bg-light-background dark:bg-dark-background rounded-full flex items-center justify-center shadow-sm hover:shadow-md transition-shadow" [disabled]="!product.product_id">
            <i class="fas fa-shopping-cart text-light-secondary dark:text-dark-secondary hover:text-light-primary-hover dark:hover:text-dark-primary-hover"></i>
          </button>
        </div>

        <!-- Product Image Area -->
        <div class="bg-light-background dark:bg-dark-blanco h-40 sm:h-48 flex items-center justify-center relative cursor-pointer" (click)="goToProductDetail(product.product_id)">
          <img [src]="product.image_url || 'assets/placeholder.jpg'" [alt]="product.name || 'Producto'" class="w-full h-full object-cover">
        </div>

        <!-- Product Info -->
        <div class="p-4 bg-light-blanco dark:bg-dark-row-hover rounded-b-2xl">
          <h3 class="text-base font-semibold text-light-text dark:text-dark-text truncate">{{ product.name || 'Producto sin nombre' }}</h3>
          <p class="text-sm text-light-secondary dark:text-dark-secondary line-clamp-2">{{ product.description || 'Sin descripci√≥n' }}</p>
          <p class="text-sm font-medium text-light-primary dark:text-dark-primary mt-1">{{ formatPrice(product) }}</p>
          <div *ngIf="shouldShowRating(product)" class="flex items-center gap-2 mt-2">
            <span class="text-sm font-medium text-light-text dark:text-dark-text">{{ getFormattedRating(product.average_rating) }}</span>
            <div class="flex items-center">
              <i *ngFor="let _ of [].constructor(getStarRating(product.average_rating).fullStars)" class="fas fa-star text-yellow-400 dark:text-dark-resolved"></i>
              <i *ngIf="getStarRating(product.average_rating).halfStar" class="fas fa-star-half-alt text-yellow-400 dark:text-dark-resolved"></i>
              <i *ngFor="let _ of [].constructor(getStarRating(product.average_rating).emptyStars)" class="far fa-star text-yellow-400 dark:text-dark-resolved"></i>
            </div>
            <span class="text-xs text-light-secondary dark:text-dark-secondary">({{ product.total_reviews }})</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay recomendaciones -->
    <div *ngIf="recommendations && recommendations.data.recommendations.length === 0 && !errorMessage" class="mt-4 text-center">
      <p class="text-light-text dark:text-dark-text">
        {{ recommendations.message || 'No hay productos recomendados disponibles en este momento.' }}
      </p>
    </div>
  </div>
</section>