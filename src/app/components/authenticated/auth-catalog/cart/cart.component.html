<div class="max-w-full mx-auto py-10 px-5 bg-light-background dark:bg-dark-background min-h-screen font-sans">
  <app-spinner [isLoading]="isLoading"></app-spinner>

  <!-- Contenido del carrito -->
  <div *ngIf="!isLoading">
    <!-- Carrito vacío -->
    <div *ngIf="cart.items.length === 0" class="flex flex-col items-center justify-center min-h-[50vh] text-center text-light-text dark:text-dark-text">
      <div class="mb-6">
        <i class="fas fa-shopping-cart text-6xl text-light-secondary dark:text-dark-secondary opacity-50"></i>
      </div>
      <h2 class="text-2xl font-semibold text-light-text dark:text-dark-text mb-2">¡Tu carrito está vacío!</h2>
      <p class="text-lg text-light-secondary dark:text-dark-secondary mb-6">
        Parece que no has añadido nada todavía. ¡Explora nuestro catálogo y encuentra algo que te guste!
      </p>
      <a routerLink="/authcatalog" class="inline-flex items-center gap-2 bg-light-primary dark:bg-dark-primary text-white font-semibold py-3 px-6 rounded-full hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105">
        Volver al catálogo
      </a>
    </div>

    <!-- Lista de productos -->
    <div *ngIf="cart.items.length > 0">
      <h1 class="text-2xl font-bold text-light-text dark:text-dark-text mb-6">Carrito de Compras</h1>

      <!-- Mensaje de promoción de conteo de pedidos -->
      <div *ngIf="orderCountPromotion" class="mb-6 p-4 rounded-lg bg-gray-100 dark:bg-gray-700">
        <p class="text-lg font-medium text-light-text dark:text-dark-text" [ngClass]="{'text-green-600 dark:text-green-400': orderCountPromotion.is_applicable}">
          {{ orderCountPromotion.progress_message }}
        </p>
      </div>

      <!-- Ítems del carrito -->
      <div *ngFor="let item of cart.items; trackBy: trackByCartDetailId" class="flex flex-col sm:flex-row items-start sm:items-center gap-4 p-4 mb-4 bg-white dark:bg-gray-800 rounded-lg shadow-md">
        <!-- Imagen -->
        <img [src]="getImageUrl(item)" class="w-24 h-24 object-cover rounded-lg" alt="{{ item.product_name }}">

        <!-- Detalles -->
        <div class="flex-1">
          <h3 class="text-lg font-medium text-light-text dark:text-dark-text">{{ item.product_name }}</h3>
          <p class="text-sm text-light-secondary dark:text-dark-secondary">Modelo: {{ item.variant_sku }}</p>
          <p class="text-sm text-light-secondary dark:text-dark-secondary">Precio unitario: ${{ item.calculated_price.toFixed(2) }}</p>
          
          <!-- Promociones aplicables -->
          <div *ngIf="item.applicable_promotions.length > 0" class="mt-2">
            <p class="text-sm font-semibold text-green-600 dark:text-green-400">Promociones aplicadas:</p>
            <ul class="list-disc list-inside text-sm text-green-600 dark:text-green-400">
              <li *ngFor="let promo of item.applicable_promotions">
                {{ promo.name }} ({{ promo.discount_value }}% descuento)
              </li>
            </ul>
          </div>

          <!-- Control de cantidad -->
          <div class="flex items-center gap-2 mt-2">
            <button (click)="updateQuantity(item, item.quantity - 1)" [disabled]="item.quantity <= 1" class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-1 px-3 rounded-full disabled:bg-light-disabled dark:disabled:bg-dark-disabled disabled:text-light-disabled-text dark:disabled:text-dark-disabled-text" aria-label="Reducir cantidad">
              -
            </button>
            <span class="text-lg text-light-text dark:text-dark-text">{{ item.quantity }}</span>
            <button (click)="updateQuantity(item, item.quantity + 1)" class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-1 px-3 rounded-full" aria-label="Aumentar cantidad">
              +
            </button>
          </div>
        </div>

        <!-- Subtotal y eliminar -->
        <div class="flex flex-col items-end gap-2">
          <p class="text-lg font-semibold text-light-text dark:text-dark-text">${{ item.subtotal.toFixed(2) }}</p>
          <button (click)="removeItem(item.cart_detail_id)" class="text-danger-text dark:text-dark-danger-text hover:text-danger-hover dark:hover:text-dark-danger-hover" aria-label="Eliminar producto">
            <i class="fas fa-trash-alt"></i> Eliminar
          </button>
        </div>
      </div>

      <!-- Resumen del carrito -->
      <div class="mt-6 p-4 bg-light-background dark:bg-dark-background border-t border-gray-300 dark:border-gray-600">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
          <a href="/authcatalog" class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-2 px-4 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors mb-4 sm:mb-0">
            Seguir comprando
          </a>
          <div class="text-right">
            <p class="text-lg font-semibold text-light-text dark:text-dark-text">Subtotal: ${{ subtotal.toFixed(2) }}</p>
            <p class="text-lg font-semibold text-green-600 dark:text-green-400" *ngIf="discount > 0">Descuento: -${{ discount.toFixed(2) }}</p>
            <p class="text-xl font-bold text-light-text dark:text-dark-text">Total: ${{ total.toFixed(2) }}</p>
            <button (click)="proceedToCheckout()" class="mt-4 bg-light-primary dark:bg-dark-primary text-white py-2 px-6 rounded-full hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover transition-colors" [disabled]="cart.items.length === 0" aria-label="Proceder al checkout">
              Proceder al checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>