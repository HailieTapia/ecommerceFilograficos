<div class="py-10 px-5 bg-light-background dark:bg-dark-background min-h-screen font-sans w-full">
  <app-spinner [isLoading]="isLoading"></app-spinner>

  <div *ngIf="!isLoading">
    <!-- Título -->
    <h1 class="text-2xl font-bold text-light-text dark:text-dark-text mb-6">Mis Órdenes</h1>

    <!-- Filtros y Búsqueda -->
    <div class="bg-white rounded-lg shadow-sm p-4 sm:p-6 mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 flex-wrap">
        <div class="relative w-full sm:w-1/2">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onFilterChange()"
            placeholder="Buscar por nombre de producto..."
            class="w-full p-2 pl-10 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>

        <select
          [(ngModel)]="dateFilter"
          (change)="onFilterChange()"
          class="w-full sm:w-48 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option *ngFor="let option of filterOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>

    <!-- Sin órdenes -->
    <div *ngIf="orders.length === 0" class="flex flex-col items-center justify-center min-h-[50vh] text-center text-light-text dark:text-dark-text">
      <div class="mb-6">
        <i class="fas fa-box-open text-6xl text-light-secondary dark:text-dark-secondary opacity-50"></i>
      </div>
      <h2 class="text-2xl font-semibold text-light-text dark:text-dark-text mb-2">¡No tienes órdenes!</h2>
      <p class="text-lg text-light-secondary dark:text-dark-secondary mb-6">
        No has realizado ninguna orden todavía. ¡Explora nuestros productos y haz tu primera compra!
      </p>
      <a routerLink="/products" class="inline-flex items-center gap-2 bg-light-primary dark:bg-dark-primary text-white font-semibold py-3 px-6 rounded-full hover:bg-light-primary-hover dark:hover:bg-dark-primary-hover transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105">
        Ver Productos
      </a>
    </div>

    <!-- Lista de órdenes con cards -->
    <div *ngIf="orders.length > 0" class="space-y-6">
      <div *ngFor="let order of orders; trackBy: trackByOrderId" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mx-4">
        <!-- Primera fila: Fecha y Total -->
        <div class="p-2 mb-2 border-b border-gray-200 dark:border-gray-600 flex justify-between items-center">
          <span class="text-sm text-light-secondary dark:text-dark-secondary">{{ getFormattedDate(order.created_at) }}</span>
          <span class="text-sm font-semibold text-light-text dark:text-dark-text">${{ order.total.toFixed(2) }}</span>
        </div>
        <!-- Segunda fila: Contenido principal (una fila con 3 columnas) -->
        <div class="grid grid-cols-[100px,1fr,auto] gap-4 items-center">
          <!-- Columna 1: Imagen (ancho fijo y alineada a la izquierda) -->
          <div class="flex justify-start">
            <img [src]="order.first_item_image" alt="Primer producto" class="w-20 h-20 object-cover rounded">
          </div>
          <!-- Columna 2: Detalles del pedido -->
          <div class="flex flex-col space-y-2">
            <span class="inline-block px-3 py-1 rounded-full text-xs font-medium border"
                  [ngClass]="{
                    'border-green-500 text-green-500': order.order_status === 'delivered',
                    'border-blue-500 text-blue-500': order.order_status === 'processing' || order.order_status === 'shipped',
                    'border-yellow-500 text-yellow-500': order.order_status === 'pending'
                  }">
              {{ getOrderStatusInSpanish(order.order_status) }}
            </span>
            <ul class="text-sm text-light-text dark:text-dark-text">
              <li *ngFor="let name of order.product_names" class="truncate">{{ name }}</li>
            </ul>
            <p class="text-xs text-light-secondary dark:text-dark-secondary">{{ order.total_items }} {{ order.total_items === 1 ? 'unidad' : 'unidades' }}</p>
          </div>
          <!-- Columna 3: Botones (ancho automático con botones más pequeños) -->
          <div class="flex flex-col space-y-2">
            <a [routerLink]="['/order-confirmation', order.order_id]" class="bg-blue-500 text-white py-1 px-3 rounded text-sm hover:bg-blue-600 transition-colors text-center">
              Ver detalles
            </a>
            <button class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-1 px-3 rounded text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors text-center">
              Volver a comprar
            </button>
          </div>
        </div>
      </div>

      <!-- Paginación -->
      <div class="flex justify-between items-center mt-6 mx-4">
        <p class="text-sm text-light-secondary dark:text-dark-secondary">
          Mostrando {{ orders.length }} de {{ pagination.totalOrders }} órdenes
        </p>
        <div class="flex gap-2">
          <button (click)="changePage(pagination.currentPage - 1)"
                  [disabled]="pagination.currentPage === 1"
                  class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-2 px-4 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50">
            Anterior
          </button>
          <button (click)="changePage(pagination.currentPage + 1)"
                  [disabled]="pagination.currentPage === pagination.totalPages"
                  class="bg-gray-200 dark:bg-gray-600 text-light-text dark:text-dark-text py-2 px-4 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50">
            Siguiente
          </button>
        </div>
      </div>
    </div>
  </div>
</div>