<div class="flex flex-col min-h-screen transition-all duration-300"
     [ngClass]="{
       'fixed left-0 top-0 z-50 h-full': isMobile,
       'translate-x-0': isMobile && sidebarOpen,
       '-translate-x-full': isMobile && !sidebarOpen,
       'relative': !isMobile,
       'w-64': sidebarOpen && !isMobile,
       'w-16': !sidebarOpen && !isMobile,
       'bg-light-background': !themeService.isDarkMode(),
       'bg-dark-background': themeService.isDarkMode()
     }">
  <!-- Sidebar Header -->
  <div class="p-4 border-b flex-shrink-0"
       [ngClass]="{'border-gray-200': !themeService.isDarkMode(), 'border-gray-600': themeService.isDarkMode()}">
    <div class="flex flex-col">
      <!-- First Row: Logo (when open) or Toggle Icon (when collapsed) -->
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center">
          <div *ngIf="sidebarOpen || isMobile" class="w-12 h-12 bg-light-background dark:bg-dark-background rounded flex items-center justify-center flex-shrink-0">
            <img *ngIf="logoPreview" [src]="logoPreview" alt="Logo" class="w-12 h-12 rounded border border-gray-200 dark:border-gray-600">
          </div>
        </div>
        <!-- Toggle Button (always visible, replaces floating button) -->
        <button
          (click)="toggleSidebar()"
          class="p-1 rounded-lg hover:bg-light-encabezado dark:hover:bg-dark-encabezado transition-colors flex-shrink-0"
          [attr.aria-label]="sidebarOpen ? 'Colapsar sidebar' : 'Expandir sidebar'"
        >
          <i class="fas w-5 h-5 text-light-text dark:text-white"
             [ngClass]="{'fa-chevron-left': sidebarOpen, 'fa-chevron-right': !sidebarOpen}"></i>
          <span class="sr-only">{{ sidebarOpen ? 'Colapsar sidebar' : 'Expandir sidebar' }}</span>
        </button>
      </div>
      <!-- Second Row: Company Name and Panel Administrativo (only when open or mobile) -->
      <div *ngIf="sidebarOpen || isMobile" class="flex items-center justify-between">
        <div class="min-w-0 transition-all duration-300 overflow-hidden"
             [ngClass]="{'w-0 opacity-0': !sidebarOpen && !isMobile, 'w-auto opacity-100': sidebarOpen || isMobile}">
          <div class="flex items-center space-x-2">
            <span class="text-2xl font-semibold text-light-text dark:text-white">{{ companyName || getTranslatedLabel('Filográficos') }}</span>
          </div>
          <p class="text-md text-light-secondary text-light-text dark:text-dark-secondary truncate">{{ getTranslatedLabel('Panel Administrativo') }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 px-2 py-4 space-y-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-700">
    <div *ngFor="let category of sidebarCategories" class="space-y-1">
      <button
        *ngIf="sidebarOpen || isMobile"
        (click)="toggleCategory(category)"
        class="flex items-center w-full px-3 py-2 text-sm font-semibold text-light-text dark:text-white uppercase"
        [ngClass]="{'opacity-0 h-0': !sidebarOpen && !isMobile, 'opacity-100 h-auto': sidebarOpen || isMobile}"
        [attr.aria-expanded]="category.collapsed ? 'false' : 'true'"
        [attr.aria-label]="getTranslatedLabel(category.label)"
      >
        {{ getTranslatedLabel(category.label) }}
        <i class="fas fa-chevron-down ml-auto transform transition-transform duration-200 text-light-text dark:text-white"
           [ngClass]="{'rotate-180': !category.collapsed}"></i>
      </button>
      <div *ngIf="!category.collapsed || isMobile" class="space-y-1">
        <div *ngFor="let item of category.items" class="relative group">
          <a [routerLink]="item.path"
            routerLinkActive="bg-light-encabezado dark:bg-dark-primary-hover shadow-lg"
            [routerLinkActiveOptions]="{ exact: false }"
            class="flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 hover:bg-light-encabezado dark:hover:bg-dark-primary-hover group"
            (click)="isMobile && toggleSidebar()"
            [attr.aria-label]="getTranslatedLabel(item.label)"
            #rla="routerLinkActive"
            [ngClass]="{
                'text-white': (rla.isActive && !themeService.isDarkMode()) || themeService.isDarkMode(),
                'text-light-text': !rla.isActive && !themeService.isDarkMode()
            }"
          >
            <i class="fas {{ item.icon }} w-5 h-5 flex-shrink-0"
              [ngClass]="{
                'text-white': (rla.isActive && !themeService.isDarkMode()) || themeService.isDarkMode(),
                'text-light-text group-hover:text-white': !rla.isActive && !themeService.isDarkMode()
              }">
            </i>
            <span class="ml-3 truncate transition-all duration-300 overflow-hidden"
                  [ngClass]="{
                    'text-white': (rla.isActive && !themeService.isDarkMode()) || themeService.isDarkMode(),
                    'text-light-text group-hover:text-white': !rla.isActive && !themeService.isDarkMode(),
                    'w-0 opacity-0': !sidebarOpen && !isMobile,
                    'w-auto opacity-100': sidebarOpen || isMobile
                  }">
              {{ getTranslatedLabel(item.label) }}
            </span>
          </a>
          <!-- Tooltip (Collapsed, Desktop) -->
          <div *ngIf="!isMobile && !sidebarOpen"
               class="absolute left-full ml-2 px-3 py-2 bg-light-background dark:bg-dark-background text-light-text dark:text-white text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 top-1/2 transform -translate-y-1/2"
               role="tooltip"
               [attr.aria-describedby]="item.label"
          >
            {{ getTranslatedLabel(item.label) }}
            <span *ngIf="item.badge" class="ml-2 bg-light-danger dark:bg-dark-danger text-light-text text-xs px-2 py-1 rounded-full">{{ item.badge }}</span>
            <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-r-4 border-r-light-background dark:border-r-dark-background border-t-4 border-t-transparent border-b-4 border-b-transparent"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Spacer to push support section to the bottom -->
    <div class="flex-1"></div>
  </nav>

  <!-- Support Section -->
  <div class="px-2 py-4 border-t flex-shrink-0"
       [ngClass]="{'border-gray-200': !themeService.isDarkMode(), 'border-gray-600': themeService.isDarkMode()}">
    <p *ngIf="sidebarOpen || isMobile" class="text-xs text-light-text dark:text-white uppercase font-semibold mb-3 px-3 transition-all duration-300"
       [ngClass]="{'opacity-0 h-0 mb-0': !sidebarOpen && !isMobile, 'opacity-100 h-auto mb-3': sidebarOpen || isMobile}">
      {{ getTranslatedLabel('Help & Center') }}
    </p>
    <div class="space-y-1">
      <div *ngFor="let item of supportItems" class="relative group">
        <a [routerLink]="item.path"
          class="flex items-center px-3 py-2 rounded-lg text-sm text-light-text dark:text-white hover:bg-light-encabezado dark:hover:bg-dark-encabezado transition-all duration-200 hover:scale-105 group"
          (click)="isMobile && toggleSidebar()"
          [attr.aria-label]="getTranslatedLabel(item.label)"
        >
          <i class="fas {{ item.icon }} w-5 h-5 flex-shrink-0 text-light-text dark:text-white group-hover:text-white"></i>
          <span class="ml-3 truncate transition-all duration-300 overflow-hidden group-hover:text-white"
                [ngClass]="{'w-0 opacity-0': !sidebarOpen && !isMobile, 'w-auto opacity-100': sidebarOpen || isMobile}">
            {{ getTranslatedLabel(item.label) }}
          </span>
        </a>
        <!-- Tooltip (Collapsed, Desktop) -->
        <div *ngIf="!isMobile && !sidebarOpen"
             class="absolute left-full ml-2 px-3 py-2 bg-light-background dark:bg-dark-background text-light-text dark:text-white text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 top-1/2 transform -translate-y-1/2"
             role="tooltip"
             [attr.aria-describedby]="item.label"
        >
          {{ getTranslatedLabel(item.label) }}
          <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-r-4 border-r-light-background dark:border-r-dark-background border-t-4 border-t-transparent border-b-4 border-b-transparent"></div>
        </div>
      </div>
      <div class="relative group">
       <button (click)="onLogout()"
                class="flex items-center px-3 py-2 mt-4 rounded-lg text-sm text-light-text dark:text-white hover:bg-light-encabezado dark:hover:bg-dark-encabezado transition-all duration-200 hover:scale-105 group"
                [attr.aria-label]="getTranslatedLabel('Cerrar Sesión')"
        >
          <i class="fas fa-sign-out-alt w-5 h-5 flex-shrink-0 text-light-text dark:text-white group-hover:text-white"></i>
          <span class="ml-3 truncate transition-all duration-300 overflow-hidden group-hover:text-white"
                [ngClass]="{'w-0 opacity-0': !sidebarOpen && !isMobile, 'w-auto opacity-100': sidebarOpen || isMobile}">
            {{ getTranslatedLabel('Cerrar Sesión') }}
          </span>
        </button>
        <!-- Tooltip (Collapsed, Desktop) -->
        <div *ngIf="!isMobile && !sidebarOpen"
             class="absolute left-full ml-2 px-3 py-2 bg-light-background dark:bg-dark-background text-light-text dark:text-white text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 top-1/2 transform -translate-y-1/2"
             role="tooltip"
             [attr.aria-describedby]="'Cerrar Sesión'"
        >
          {{ getTranslatedLabel('Cerrar Sesión') }}
          <div class="absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-r-4 border-r-light-background dark:border-r-dark-background border-t-4 border-t-transparent border-b-4 border-b-transparent"></div>
        </div>
      </div>
    </div>
  </div>
</div>