<div *ngIf="order" class="p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Orden #{{ order.order_id }}</h2>
    <button mat-icon-button (click)="onClose()" class="hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">Cliente</h3>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Nombre:</strong> {{ order.customer_name }}</p>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>ID Usuario:</strong> {{ order.user_id }}</p>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Entrega:</strong> {{ order.delivery_option || 'No especificada' }}</p>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Fecha creación:</strong> {{ formatDate(order.created_at) }}</p>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Fecha estimada entrega:</strong> {{ formatDate(order.estimated_delivery_date) }}</p>
      <ng-container *ngIf="order.address">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mt-4 mb-2">Dirección</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Calle:</strong> {{ order.address.street }}</p>
        <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Ciudad:</strong> {{ order.address.city }}</p>
        <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Estado:</strong> {{ order.address.state }}</p>
        <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Código postal:</strong> {{ order.address.postal_code }}</p>
      </ng-container>
    </div>

    <div>
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">Estado y Pago</h3>
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Estado de la orden</mat-label>
        <mat-select [(ngModel)]="order.order_status" (ngModelChange)="onStatusChange($event)">
          <mat-option value="pending">Pendiente</mat-option>
          <mat-option value="processing">Procesando</mat-option>
          <mat-option value="shipped">Enviado</mat-option>
          <mat-option value="delivered">Entregado</mat-option>
        </mat-select>
      </mat-form-field>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Pago:</strong>
        <span class="px-2 py-1 rounded-full text-xs font-medium {{ paymentStatusColors[order.payment_status] }}">
          {{ order.payment_status }}
        </span>
      </p>
      <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Método:</strong> {{ order.payment_method }}</p>
    </div>
  </div>

  <div class="mt-6">
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">Productos</h3>
    <div class="space-y-2">
      <ng-container *ngFor="let detail of order.order_details">
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
          <div>
            <span class="font-medium text-gray-900 dark:text-gray-100">{{ detail.product_name }}</span>
            <ng-container *ngIf="detail.is_urgent">
              <span class="ml-2 px-2 py-1 bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100 text-xs rounded-full">Urgente</span>
            </ng-container>
            <p class="text-sm text-gray-600 dark:text-gray-400">Cantidad: {{ detail.quantity }}</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">Unidad: {{ detail.unit_measure }}</p>
          </div>
          <span class="font-medium text-gray-900 dark:text-gray-100">{{ formatCurrency(detail.subtotal) }}</span>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="mt-6 border-t pt-4">
    <div class="space-y-2">
      <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400">
        <span>Subtotal:</span>
        <span>{{ formatCurrency(order.total - order.shipping_cost + order.discount) }}</span>
      </div>
      <ng-container *ngIf="order.discount > 0">
        <div class="flex justify-between text-sm text-green-600 dark:text-green-400">
          <span>Descuento:</span>
          <span>-{{ formatCurrency(order.discount) }}</span>
        </div>
      </ng-container>
      <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400">
        <span>Envío:</span>
        <span>{{ formatCurrency(order.shipping_cost) }}</span>
      </div>
      <div class="flex justify-between font-semibold text-lg text-gray-900 dark:text-gray-100 border-t pt-2">
        <span>Total:</span>
        <span>{{ formatCurrency(order.total) }}</span>
      </div>
    </div>
  </div>

  <div class="mt-6 flex gap-3">
    <button mat-raised-button color="primary" class="flex-1 bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600" (click)="onStatusChange(order.order_status)">
      <mat-icon>save</mat-icon> Guardar
    </button>
    <button mat-raised-button color="accent" class="flex-1 bg-gray-600 text-white hover:bg-gray-700 dark:bg-gray-500 dark:hover:bg-gray-600" (click)="viewDetails()">
      <mat-icon>visibility</mat-icon> Ver detalles completos
    </button>
  </div>
</div>